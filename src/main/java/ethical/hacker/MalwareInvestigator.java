package ethical.hacker;

import java.nio.file.Path;
import java.util.List;
import java.util.Objects;
import java.util.stream.Stream;
import javafx.application.Application;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;
import schema.sngpc.JsonViewer;
import simplebuilder.StageHelper;
import utils.FunctionEx;
import utils.ResourceFXUtils;

public class MalwareInvestigator extends Application {

    @Override
    public void start(Stage primaryStage) throws Exception {
        JsonViewer jsonViewer = new JsonViewer();
        Parent root = new VBox(StageHelper.chooseFile("Verify Virus Total", "Choose Exe", f -> {
            jsonViewer.start(primaryStage);
            jsonViewer.setFile(VirusTotalApi.getFilesInformation(HashVerifier.getSha256Hash(f.toPath())));
        }, "Executable", "*.exe", "*.dll", "*.msi"),
                StageHelper.selectDirectory("Verify Directory", "Choose Dir", f -> {
                    jsonViewer.start(primaryStage);
                    List<Path> pathByExtension = ResourceFXUtils.getPathByExtension(f, ".exe", ".dll", ".msi");
                    pathByExtension.stream().map(FunctionEx.makeFunction(HashVerifier::getSha256Hash))
                            .filter(Objects::nonNull)
                            .flatMap(FunctionEx.makeFunction(p -> Stream.of(VirusTotalApi.getFilesInformation(p))))
                            .filter(Objects::nonNull).forEach(jsonViewer::setFile);
                }));
        primaryStage.setScene(new Scene(root));
        primaryStage.show();
    }

    public static void main(String[] args) {
        launch(args);
    }
}